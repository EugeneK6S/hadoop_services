{
	context:{
			timeout:300,
			checkTime:0.25
	},
	flow:[
		{
			command:"runInstance",
			input:{
				imageId:"Ubuntu12.04-template",
				shape:"small"
			},
			set:[
				"instanceId"
			],
			next:[
				{
				   command:"waitInstance",
				   for:{
						field:"state",
						required:"running"
					},
					next:[
						{
							command:"checkInstance",
							toCheck:[
								{
								   field:"dnsName",
								   is:"!empty"
								},
								{
								   field:"privateIp",
								   is:"!empty"
								}
							],
							next:[
								{
									command:"setInstanceProperties",
									input:{
									  properties:"ep_chefrole=hadoop-namenode; ep_chefattributes=project=ha6,hadoop_services.is_active_nn=true"
									}										
								}
							]
						}
					]
				}
			]
		},
		{
			command:"runInstance",
			input:{
				imageId:"Ubuntu12.04-template",
				shape:"small"
			},
			set:[
				"instanceId"
			],
			next:[
				{
					command:"waitInstance",
					for:{
						field:"state",
						required:"running"
					},
					next:[
						{
							command:"checkInstance",
							toCheck:[
								{
								   field:"dnsName",
								   is:"!empty"
								},
								{
								   field:"privateIp",
								   is:"!empty"
								}
							],
							next:[
								{
									command:"setInstanceProperties",
									input:{
									  properties:"ep_chefrole=hadoop-namenode; ep_chefattributes=project=ha6,hadoop_services.is_standby_nn=true"
									}										
								}
							]
						}
					]
				}
			]
		},
		{
			command:"runInstance",
			input:{
				imageId:"Ubuntu12.04-template",
				shape:"small"
			},
			set:[
				"instanceId"
			],
			next:[
				{
					command:"waitInstance",
					for:{
						field:"state",
						required:"running"
					},
					next:[
						{
							command:"checkInstance",
							toCheck:[
								{
								   field:"dnsName",
								   is:"!empty"
								},
								{
								   field:"privateIp",
								   is:"!empty"
								}
							],
							next:[
								{
									command:"setInstanceProperties",
									input:{
									  properties:"ep_chefrole=hadoop-resourcemanager; ep_chefattributes=project=ha6"
									}										
								}
							]
						}
					]
				}
			]
		},
		{
			command:"runInstance",
			input:{
				imageId:"Ubuntu12.04-template",
				shape:"medium",
				count: 3
			},
			set:[
				"instanceId"
			],
			next:[
				{
					command:"waitInstance",
					for:{
						field:"state",
						required:"running"
					},
					next:[
						{
							command:"checkInstance",
							toCheck:[
								{
								   field:"dnsName",
								   is:"!empty"
								},
								{
								   field:"privateIp",
								   is:"!empty"
								}
							],
							next:[
								{
									command:"setInstanceProperties",
									input:{
									  properties:"ep_chefrole=hadoop-slave; ep_chefattributes=project=ha6"
									}										
								}
							]
						}
					]
				}
			]
		},
		{
			command:"runInstance",
			input:{
				imageId:"Ubuntu12.04-template",
				shape:"small"
			},
			set:[
				"instanceId"
			],
			next:[
				{
					command:"waitInstance",
					for:{
						field:"state",
						required:"running"
					},
					next:[
						{
							command:"checkInstance",
							toCheck:[
								{
								   field:"dnsName",
								   is:"!empty"
								},
								{
								   field:"privateIp",
								   is:"!empty"
								}
							],
							next:[
								{
									command:"setInstanceProperties",
									input:{
									  properties:"ep_chefrole=hadoop-client; ep_chefattributes=project=ha6"
									}										
								}
							]
						}
					]
				}
			]
		}		
	]	
}